### 6.1.8. ファイルへの同時アクセス制御

データファイルの操作は、COBOL言語の大きな強みの1つである。複数のプログラムが同じファイルに同時にアクセスしようとする可能性を対処するため、COBOL言語に組み込まれている機能がある。複数プログラムの同時アクセスは、ファイル共有とレコードロックの2つの方法で処理される。

すべてのopensource COBOL実装がファイル共有およびレコードロックオプションをサポートしているわけではない。それらが構築されたオペレーティングシステムと、特定のopensource COBOL実装が生成されたときに使用されたビルドオプションによって異なる。

#### 6.1.8.1. ファイル共有

opensource COBOLは、プログラムがファイルを開こうとしたときに適用されるファイル共有の概念によって、最水準でファイルの同時アクセスを制御する([6.31](6-31.md)を参照)。これは「**fcntl()**」と呼ばれるUNIXオペレーティングシステムルーチンを介して実行される。そのモジュールは現在Windowsでサポートされておらず`15`、MinGW Unixエミュレーションパッケージに含まれていない。MinGW環境を使用して作成されたopensource COBOLビルドは、ファイル共有制御をサポートできなくなる―そのような環境ではファイルが<u>常に</u>共有される。WindowsでCygwin環境を使用して作成されたopensource COBOLビルドは、「fcntl()」にアクセスできる<u>と思われる</u>ため、ファイル共有をサポートする<u>だろう</u>。もちろん、opensource COBOLのUnixビルドやMacOSビルドは`16`、「fcntl()」がUnixに組み込まれているため、BDBを使用しても問題はない。

OPENの成功に課せられる制限は、プログラムがファイルをCLOSEするか、終了するまで残る。

ファイルへの同時アクセスをファイルレベルで制御するには、次の3つの方法がある。

|共有オプション |効果 |
| :--- | :--- |
|ALL OTHER|あなたのプログラムがファイルを開いた後に、他のプログラムがファイルを開こうとしても制限されない。これはSHARING句が指定されなかったときの既定値である。|
|NO OTHER|あなたのプログラムがファイルを使用している限り、他の<u>どんな</u>プログラムによる、<u>どんな</u>ファイルアクセスも許可しない。他のプログラムによって行われたOPENの試行は、あなたがファイルを閉じるまでファイル状態コード37(「ファイルアクセスが拒否されました」)で失敗する([6.9](6-9.md)を参照)。|
|READ ONLY|あなたがファイルを開いている間、他のプログラムがINPUTのためにファイルを開くことを許可する。他の目的でOPENを試行すると、ファイル状態コード37で失敗する。|

誰かが最初にファイルにアクセスし、ファイル共有を制限する共有オプションでファイルをOPENした場合、当然<u>あなたの</u>プログラムはアクセスに失敗する。

---
`15` Windowsには「fcntl()」と同様の機能があるが、BDBパッケージはそれらの機能を利用するようにコーディングされていない。UNIXとWindowsの<u>両方の</u>同時アクセスルーチン(VBISAMなど)をサポートする高度なファイルI / Oパッケージの使用は、現在、著者によって調査中である。

`16` Apple ComputerのMacOS XオペレーティングシステムはUNIXのオープンソースバージョンに基づいているため、「fcntl()」のサポートが含まれている。
